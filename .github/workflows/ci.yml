name: Lint and Build Checks

on:
  push:
    branches: [ "main" ]
    paths:
      - "backend/**"
      - "hotel-booking-frontend/**"
      - "scripts/run-ci-checks.sh"
      - "shared/**"
      - ".github/workflows/ci.yml"
  pull_request:
    branches: [ "main" ]

permissions:
  contents: read

jobs:
  quality:
    name: Run repository checks
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: npm
          cache-dependency-path: |
            package-lock.json
            backend/services/api-gateway/package-lock.json
            backend/services/identity-service/package-lock.json
            backend/services/hotel-service/package-lock.json
            backend/services/booking-service/package-lock.json
            backend/services/search-service/package-lock.json
            backend/services/notification-service/package-lock.json
            hotel-booking-frontend/package-lock.json

      - name: Run lint and build suite
        run: scripts/run-ci-checks.sh
